name: CI/CD

on:
  push:
    branches: master
  workflow_dispatch:

jobs:
  empaquetado:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2
      - name: Script para empaquetar
        run: |
          conda activate splunk-app-packager
          py C:\Users\lpuentes\Documents\actions-runner\_work\packager_script\splunk_app_packager.py demo-app
          conda deactivate
        
#  ${{ github.repository }}
  instalacion:
    needs: empaquetado
    runs-on: self-hosted
#     environment: produccion
    steps:
      - name: copy file via ssh password
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.KEY_SERVER }}
          source: "demo-app.tar.gz"
          target: "Paquetes_Splunk"
